{
  "feature": "slack-assistant-professional",
  "name": "Professional Slack Assistant — Noise Reduction & Smart Filtering",
  "description": "Transform the Slack AI assistant from spammy notification bot to a professional, context-aware sales assistant. Fix notification frequency, add smart task categorization, filter non-meeting calendar events, add actionable buttons, and suppress link unfurls.",
  "createdAt": "2026-02-24T09:00:00Z",
  "consultReport": ".sixty/consult/slack-assistant-professional.md",
  "totalEstimate": "3 hours",
  "mvpEstimate": "1.5 hours (Phase 1 + 2)",

  "stories": [
    {
      "id": "SLKPRO-001",
      "feature": "slack-assistant-professional",
      "title": "Fix unpinned @supabase/supabase-js@2 import in proactive-task-analysis",
      "type": "bugfix",
      "status": "complete",
      "priority": 1,
      "phase": 1,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-002", "SLKPRO-003", "SLKPRO-004"],
      "acceptance": [
        "proactive-task-analysis/index.ts imports @supabase/supabase-js@2.43.4 (pinned)",
        "Function no longer intermittently 500s from broken esm.sh resolution"
      ],
      "estimatedMinutes": 2,
      "files": [
        "supabase/functions/proactive-task-analysis/index.ts"
      ]
    },
    {
      "id": "SLKPRO-002",
      "feature": "slack-assistant-professional",
      "title": "Suppress link unfurls on all Slack postMessage calls",
      "type": "bugfix",
      "status": "complete",
      "priority": 2,
      "phase": 1,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-001", "SLKPRO-003", "SLKPRO-004"],
      "acceptance": [
        "All chat.postMessage calls include unfurl_links: false, unfurl_media: false",
        "proactive-task-analysis sendTaskNotification() includes unfurl params",
        "slack-copilot-actions sendSlackMessage() and sendSlackBlocks() include unfurl params",
        "_shared/proactive/deliverySlack.ts deliverToSlack() includes unfurl params",
        "slack-interactive postToChannel() includes unfurl params",
        "No Open Graph previews appear for use60.com links in Slack"
      ],
      "estimatedMinutes": 15,
      "files": [
        "supabase/functions/proactive-task-analysis/index.ts",
        "supabase/functions/slack-copilot-actions/index.ts",
        "supabase/functions/_shared/proactive/deliverySlack.ts",
        "supabase/functions/slack-interactive/index.ts"
      ]
    },
    {
      "id": "SLKPRO-003",
      "feature": "slack-assistant-professional",
      "title": "Eliminate task reminder spam — daily only with dedup + quiet hours",
      "type": "enhancement",
      "status": "complete",
      "priority": 3,
      "phase": 1,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-001", "SLKPRO-002", "SLKPRO-004"],
      "acceptance": [
        "Cron changed from '0 */4 * * *' to '0 9 * * 1-5' (once daily 9AM UTC, weekdays only)",
        "proactive-task-analysis imports and calls shouldSendNotification() with 24h cooldown",
        "proactive-task-analysis imports and calls checkUserDeliveryPolicy() for quiet hours",
        "Cross-dedup: skips if morning_brief was already sent today for this user",
        "No more notifications at 12AM, 4AM, or weekends"
      ],
      "estimatedMinutes": 20,
      "files": [
        "supabase/functions/proactive-task-analysis/index.ts",
        "supabase/migrations/new_fix_task_analysis_cron.sql"
      ]
    },
    {
      "id": "SLKPRO-004",
      "feature": "slack-assistant-professional",
      "title": "Remove duplicate enhanced-morning-briefing cron job",
      "type": "bugfix",
      "status": "complete",
      "priority": 4,
      "phase": 1,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-001", "SLKPRO-002", "SLKPRO-003"],
      "acceptance": [
        "Migration drops the enhanced-morning-briefing cron job",
        "Only slack-morning-brief (polling-based, respects user preferred time) sends the morning brief",
        "No more duplicate morning briefings at 8AM"
      ],
      "estimatedMinutes": 10,
      "files": [
        "supabase/migrations/new_drop_duplicate_morning_cron.sql"
      ]
    },
    {
      "id": "SLKPRO-005",
      "feature": "slack-assistant-professional",
      "title": "Add task_category column with heuristic backfill",
      "type": "schema",
      "status": "complete",
      "priority": 5,
      "phase": 2,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": ["SLKPRO-006"],
      "parallelWith": ["SLKPRO-007"],
      "acceptance": [
        "tasks table has task_category column: TEXT DEFAULT 'rep_action'",
        "CHECK constraint allows: rep_action, prospect_action, admin, internal",
        "Backfill migration classifies existing tasks by title keywords",
        "Prospect action keywords: 'review proposal', 'sign contract', 'get back to', 'internal approval', 'send budget', 'confirm availability'",
        "Admin keywords: 'pay', 'payroll', 'invoice', 'court', 'renew', 'terminate contract'",
        "Index on (assigned_to, status, task_category) for query performance"
      ],
      "estimatedMinutes": 15,
      "files": [
        "supabase/migrations/new_add_task_category.sql"
      ]
    },
    {
      "id": "SLKPRO-006",
      "feature": "slack-assistant-professional",
      "title": "Smart prospect task filtering with stale commitment nudges",
      "type": "enhancement",
      "status": "complete",
      "priority": 6,
      "phase": 2,
      "dependencies": { "stories": ["SLKPRO-005"], "files": [], "schema": ["tasks.task_category"] },
      "blocks": [],
      "parallelWith": [],
      "acceptance": [
        "proactive-task-analysis filters task queries to task_category IN ('rep_action', 'admin')",
        "Separate query for prospect_action tasks that are >1 day overdue",
        "Stale prospect tasks rendered differently: '{Contact} said they would {task} but hasn't yet. Want to call or shall I draft a follow-up email?'",
        "Stale prospect section has Call and Draft Email action buttons",
        "Tasks like 'Send Payroll' categorized as admin and grouped separately from sales tasks"
      ],
      "estimatedMinutes": 30,
      "files": [
        "supabase/functions/proactive-task-analysis/index.ts"
      ]
    },
    {
      "id": "SLKPRO-007",
      "feature": "slack-assistant-professional",
      "title": "Filter non-meeting calendar events from meeting prep",
      "type": "enhancement",
      "status": "complete",
      "priority": 7,
      "phase": 2,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": ["SLKPRO-008"],
      "parallelWith": ["SLKPRO-005"],
      "acceptance": [
        "Hard gate: attendees_count > 1 required (remove staging fallback that drops filter)",
        "New TASK_TITLE_PATTERNS regex array catches: send payroll, pay court fee, pay invoice, submit report, renew subscription, book travel, etc.",
        "Events matching task patterns are silently skipped (no 'I wasn't sure' prompt)",
        "Events with 0-1 attendees are silently skipped",
        "Only genuinely ambiguous events (2+ attendees, unknown classification) trigger the 'Is this a sales meeting?' prompt"
      ],
      "estimatedMinutes": 20,
      "files": [
        "supabase/functions/proactive-meeting-prep/index.ts"
      ]
    },
    {
      "id": "SLKPRO-008",
      "feature": "slack-assistant-professional",
      "title": "Cross-dedup meeting prep with morning brief",
      "type": "enhancement",
      "status": "complete",
      "priority": 8,
      "phase": 2,
      "dependencies": { "stories": ["SLKPRO-007"], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": [],
      "acceptance": [
        "proactive-meeting-prep checks shouldSendNotification() with type meeting_prep and entity scope per meeting ID",
        "If morning brief was sent <2h ago and included this meeting, skip standalone meeting prep",
        "Meeting prep only fires for meetings NOT already covered in the morning brief",
        "No more duplicate meeting mentions at 7AM + 8AM"
      ],
      "estimatedMinutes": 15,
      "files": [
        "supabase/functions/proactive-meeting-prep/index.ts"
      ]
    },
    {
      "id": "SLKPRO-009",
      "feature": "slack-assistant-professional",
      "title": "Add Complete and Snooze buttons to task reminders",
      "type": "enhancement",
      "status": "complete",
      "priority": 9,
      "phase": 3,
      "dependencies": { "stories": ["SLKPRO-001"], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-010"],
      "acceptance": [
        "Each task in the reminder has 'Done' and 'Snooze 1d' buttons",
        "Done button uses action_id task_complete with value JSON {taskId}",
        "Snooze button uses action_id task_snooze_1d with value JSON {taskId}",
        "Both wire to existing handlers in slack-interactive (handleTaskComplete, handleTaskSnooze)",
        "After clicking Done, the task section updates to show strikethrough/completed state"
      ],
      "estimatedMinutes": 20,
      "files": [
        "supabase/functions/proactive-task-analysis/index.ts"
      ]
    },
    {
      "id": "SLKPRO-010",
      "feature": "slack-assistant-professional",
      "title": "Fix '7 overdue but shows 5' count mismatch",
      "type": "bugfix",
      "status": "complete",
      "priority": 10,
      "phase": 3,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-009"],
      "acceptance": [
        "Summary line matches displayed count: 'Showing 5 of 7 overdue' if truncated",
        "If <=5 tasks, show all with exact count",
        "Add 'View all overdue' button linking to /tasks?filter=overdue when truncated",
        "No misleading count discrepancy"
      ],
      "estimatedMinutes": 10,
      "files": [
        "supabase/functions/proactive-task-analysis/index.ts"
      ]
    },
    {
      "id": "SLKPRO-011",
      "feature": "slack-assistant-professional",
      "title": "Fix slack_auth dead table reference in slack-copilot-actions",
      "type": "bugfix",
      "status": "complete",
      "priority": 11,
      "phase": 4,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-012"],
      "acceptance": [
        "slack-copilot-actions thread reply handler queries slack_user_mappings + slack_org_settings instead of slack_auth",
        "Thread replies to proactive Slack messages no longer silently fail",
        "User can reply to task reminders and get copilot responses"
      ],
      "estimatedMinutes": 15,
      "files": [
        "supabase/functions/slack-copilot-actions/index.ts"
      ]
    },
    {
      "id": "SLKPRO-012",
      "feature": "slack-assistant-professional",
      "title": "Fix appUrl default from use60.com to app.use60.com",
      "type": "bugfix",
      "status": "complete",
      "priority": 12,
      "phase": 4,
      "dependencies": { "stories": [], "files": [], "schema": [] },
      "blocks": [],
      "parallelWith": ["SLKPRO-011"],
      "acceptance": [
        "slack-interactive appUrl defaults to https://app.use60.com",
        "All button URLs route to the app, not the marketing site"
      ],
      "estimatedMinutes": 2,
      "files": [
        "supabase/functions/slack-interactive/index.ts"
      ]
    }
  ],

  "phases": {
    "phase1": {
      "name": "Stop the Bleeding — Critical Fixes",
      "stories": ["SLKPRO-001", "SLKPRO-002", "SLKPRO-003", "SLKPRO-004"],
      "estimateMinutes": 47,
      "parallelGroups": [["SLKPRO-001", "SLKPRO-002", "SLKPRO-003", "SLKPRO-004"]],
      "outcome": "No more spam, no more 4AM notifications, no more link unfurl mess"
    },
    "phase2": {
      "name": "Smart Filtering — Task Categories & Meeting Detection",
      "stories": ["SLKPRO-005", "SLKPRO-006", "SLKPRO-007", "SLKPRO-008"],
      "estimateMinutes": 80,
      "parallelGroups": [["SLKPRO-005", "SLKPRO-007"], ["SLKPRO-006", "SLKPRO-008"]],
      "outcome": "Prospect tasks filtered, non-meetings excluded, stale commitment nudges"
    },
    "phase3": {
      "name": "Actionable Notifications",
      "stories": ["SLKPRO-009", "SLKPRO-010"],
      "estimateMinutes": 30,
      "parallelGroups": [["SLKPRO-009", "SLKPRO-010"]],
      "outcome": "Tasks completable from Slack, accurate counts"
    },
    "phase4": {
      "name": "Bug Fixes",
      "stories": ["SLKPRO-011", "SLKPRO-012"],
      "estimateMinutes": 17,
      "parallelGroups": [["SLKPRO-011", "SLKPRO-012"]],
      "outcome": "Thread replies work, correct app URLs"
    }
  },

  "execution": {
    "totalStories": 12,
    "completedStories": 12,
    "currentPhase": 4,
    "lastUpdated": "2026-02-24T09:00:00Z"
  }
}
