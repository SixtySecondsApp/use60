[
  {
    "id": "ORG-NOTIF-004",
    "feature": "org-notifications",
    "title": "Add member management notifications",
    "type": "backend",
    "status": "pending",
    "priority": 4,
    "dependencies": { "stories": ["ORG-NOTIF-003"], "files": [], "schema": ["organization_memberships"] },
    "blocks": [],
    "parallelWith": [],
    "acceptance": [
      "Trigger created for member_status change from active to removed",
      "Notification sent to org admins/owners when member removed",
      "Trigger created for role changes on organization_memberships",
      "Notification sent to admins and affected user when role changes",
      "Notification includes who made the change (actioned_by)"
    ],
    "estimatedMinutes": 45,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000004_member_management_notifications.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-005",
    "feature": "org-notifications",
    "title": "Add high-value deal notifications",
    "type": "backend",
    "status": "pending",
    "priority": 5,
    "dependencies": { "stories": ["ORG-NOTIF-003"], "files": [], "schema": ["deals"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-006", "ORG-NOTIF-007"],
    "acceptance": [
      "Trigger created on deals INSERT for high-value deals (>$50k)",
      "Notification sent to org owners/admins when high-value deal created",
      "Trigger created on deals UPDATE for stage changes to closed_won/closed_lost",
      "Won deals show success notification with celebration emoji",
      "Lost deals show warning notification"
    ],
    "estimatedMinutes": 30,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000005_deal_notifications.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-006",
    "feature": "org-notifications",
    "title": "Enhance deal health notifications for admins",
    "type": "backend",
    "status": "pending",
    "priority": 6,
    "dependencies": { "stories": ["ORG-NOTIF-003"], "files": ["src/lib/services/dealHealthAlertService.ts"], "schema": [] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-005", "ORG-NOTIF-007"],
    "acceptance": [
      "dealHealthAlertService.ts updated to check alert severity",
      "Critical alerts also notify org admins/owners via notify_org_members()",
      "Notification includes deal name, owner, and suggested actions",
      "Alert type and severity included in metadata",
      "Original owner notification still sent"
    ],
    "estimatedMinutes": 25,
    "actualMinutes": null,
    "files": ["src/lib/services/dealHealthAlertService.ts"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-007",
    "feature": "org-notifications",
    "title": "Add organization settings change notifications",
    "type": "backend",
    "status": "pending",
    "priority": 7,
    "dependencies": { "stories": ["ORG-NOTIF-003"], "files": [], "schema": ["organizations"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-005", "ORG-NOTIF-006"],
    "acceptance": [
      "Trigger created on organizations UPDATE",
      "Notifications sent when org name changes",
      "Notifications sent when logo_url changes",
      "Notifications sent when notification_settings change",
      "Notification includes who made the change"
    ],
    "estimatedMinutes": 20,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000006_org_settings_notifications.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-008",
    "feature": "org-notifications",
    "title": "Create weekly activity digest system",
    "type": "backend",
    "status": "pending",
    "priority": 8,
    "dependencies": { "stories": ["ORG-NOTIF-003", "ORG-NOTIF-005", "ORG-NOTIF-006"], "files": [], "schema": ["deals", "meetings", "tasks"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-009", "ORG-NOTIF-010"],
    "acceptance": [
      "digest_schedules table created with org_id, digest_type, enabled, recipient_roles",
      "generate_weekly_digest() function created to aggregate stats",
      "send_weekly_digest() function created to send notifications",
      "Default schedule seeded for existing orgs (disabled, Monday, owners only)",
      "Digest includes deals won/lost, meetings held, tasks completed, active members"
    ],
    "estimatedMinutes": 60,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000007_weekly_digest_system.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-009",
    "feature": "org-notifications",
    "title": "Create OrgActivityFeed component",
    "type": "frontend",
    "status": "pending",
    "priority": 9,
    "dependencies": { "stories": ["ORG-NOTIF-001", "ORG-NOTIF-002"], "files": ["src/lib/services/notificationService.ts"], "schema": ["notifications"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-008", "ORG-NOTIF-010"],
    "acceptance": [
      "OrgActivityFeed component created in src/components/notifications/",
      "Component fetches org-wide notifications for active org",
      "Real-time subscription set up for new org-wide notifications",
      "Notifications display with type badges and category colors",
      "Click on notification navigates to action_url",
      "Component shows loading state and empty state"
    ],
    "estimatedMinutes": 45,
    "actualMinutes": null,
    "files": ["src/components/notifications/OrgActivityFeed.tsx"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-010",
    "feature": "org-notifications",
    "title": "Create low engagement alert system",
    "type": "backend",
    "status": "pending",
    "priority": 10,
    "dependencies": { "stories": ["ORG-NOTIF-003"], "files": [], "schema": ["organization_memberships", "profiles"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-008", "ORG-NOTIF-009"],
    "acceptance": [
      "check_member_engagement() function created",
      "Function loops through all orgs checking for inactive members",
      "Inactive defined as last_seen > 7 days ago or NULL",
      "Notification sent to admins/owners with list of inactive members",
      "Metadata includes inactive_members array and threshold_days"
    ],
    "estimatedMinutes": 30,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000008_engagement_alerts.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-011",
    "feature": "org-notifications",
    "title": "Add notification batching and consolidation",
    "type": "backend",
    "status": "pending",
    "priority": 11,
    "dependencies": { "stories": ["ORG-NOTIF-001"], "files": ["src/lib/services/notificationService.ts"], "schema": ["notifications"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-012", "ORG-NOTIF-013", "ORG-NOTIF-014"],
    "acceptance": [
      "createBatched() method added to notificationService",
      "Batch queue implemented with 1-minute window",
      "flushBatches() consolidates similar notifications",
      "Consolidated notifications show count and individual details in metadata",
      "consolidate_recent_notifications() RPC function created"
    ],
    "estimatedMinutes": 45,
    "actualMinutes": null,
    "files": ["src/lib/services/notificationService.ts", "supabase/migrations/20260205000009_notification_batching.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-012",
    "feature": "org-notifications",
    "title": "Extend Slack integration for org notifications",
    "type": "backend",
    "status": "pending",
    "priority": 12,
    "dependencies": { "stories": ["ORG-NOTIF-001"], "files": [], "schema": ["slack_notification_settings"] },
    "blocks": [],
    "parallelWith": ["ORG-NOTIF-011", "ORG-NOTIF-013", "ORG-NOTIF-014"],
    "acceptance": [
      "slack_notification_settings updated with notify_on_tasks, notify_on_deals, notify_on_team_changes columns",
      "slack_channel_mappings table created for category-to-channel mapping",
      "SlackNotificationService.sendOrgNotificationToSlack() method created",
      "Function fetches channel mapping and Slack credentials",
      "Slack Block Kit message sent with title, message, and action button"
    ],
    "estimatedMinutes": 40,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000010_slack_org_notifications.sql", "src/lib/services/slackNotificationService.ts", "supabase/functions/slack-notification/index.ts"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-013",
    "feature": "org-notifications",
    "title": "Create notification preferences UI",
    "type": "frontend",
    "status": "pending",
    "priority": 13,
    "dependencies": { "stories": [], "files": ["src/lib/services/notificationService.ts"], "schema": [] },
    "blocks": ["ORG-NOTIF-014"],
    "parallelWith": ["ORG-NOTIF-011", "ORG-NOTIF-012"],
    "acceptance": [
      "user_notification_preferences table created with frequency, channels, muted categories",
      "NotificationPreferences component created in src/pages/settings/",
      "UI shows frequency dropdown (immediate, hourly, daily, weekly)",
      "Toggles for in-app, email, Slack DM delivery channels",
      "Toggle for weekly digest opt-in",
      "Category mute toggles for task, deal, team, system"
    ],
    "estimatedMinutes": 60,
    "actualMinutes": null,
    "files": ["supabase/migrations/20260205000011_notification_preferences.sql", "src/pages/settings/NotificationPreferences.tsx", "src/App.tsx"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  },
  {
    "id": "ORG-NOTIF-014",
    "feature": "org-notifications",
    "title": "Integrate notification queue for intelligent delivery",
    "type": "backend",
    "status": "pending",
    "priority": 14,
    "dependencies": { "stories": ["ORG-NOTIF-013"], "files": ["src/lib/services/notificationService.ts"], "schema": ["notification_queue", "user_notification_preferences"] },
    "blocks": [],
    "parallelWith": [],
    "acceptance": [
      "notificationService.create() updated to check user preferences",
      "Urgent notifications bypass queue and send immediately",
      "Non-urgent notifications queued via queue_notification RPC",
      "createImmediate() private method for urgent delivery",
      "process-notification-queue edge function created",
      "Function processes pending notifications, creates actual notifications, marks as sent"
    ],
    "estimatedMinutes": 50,
    "actualMinutes": null,
    "files": ["src/lib/services/notificationService.ts", "supabase/functions/process-notification-queue/index.ts", "supabase/migrations/20260205000012_queue_integration.sql"],
    "designRef": null,
    "ticketId": null,
    "startedAt": null,
    "completedAt": null
  }
]
