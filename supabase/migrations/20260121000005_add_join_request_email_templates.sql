-- Add email templates for join request approval workflow
-- Templates: join_request_approved, join_request_rejected, join_request_admin_notification

-- Template 1: join_request_approved - sent to user when admin approves their request
INSERT INTO encharge_email_templates (
  template_name,
  template_type,
  subject_line,
  html_body,
  text_body,
  variables,
  is_active,
  created_at,
  updated_at
) VALUES (
  'Join Request Approved',
  'join_request_approved',
  'Welcome to {{org_name}}! Your Request Was Approved ✅',
  '<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="color-scheme" content="light"><meta name="supported-color-schemes" content="light"><title>Welcome to {{org_name}} - Sixty Seconds</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style type="text/css">body, table, td, p, a, li, blockquote { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }table, td { mso-table-lspace: 0pt; mso-table-rspace: 0pt; }img { -ms-interpolation-mode: bicubic; border: 0; outline: none; text-decoration: none; }html {color-scheme: light !important;background-color: #030712 !important;margin: 0 !important;padding: 0 !important;height: 100% !important;}body {color-scheme: light !important;background-color: #030712 !important;margin: 0 !important;padding: 0 !important;height: 100% !important;width: 100% !important;-webkit-text-fill-color: #F3F4F6 !important;}* {color-scheme: light !important;forced-color-adjust: none !important;}</style></head><body style="margin: 0 !important; padding: 0 !important; font-family: ''Inter'', -apple-system, BlinkMacSystemFont, ''Segoe UI'', Roboto, sans-serif; background-color: #030712 !important; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; color-scheme: light !important; forced-color-adjust: none !important; -webkit-text-fill-color: #FFFFFF !important; color: #FFFFFF !important; width: 100% !important;"><div style="background-color: #111827 !important; min-height: 100vh; width: 100% !important; margin: 0 !important; padding: 0 !important;"><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #030712 !important; padding: 0; margin: 0 auto; width: 100% !important; forced-color-adjust: none !important;"><tr style="background-color: #030712 !important;"><td align="center" style="padding: 20px 0; background-color: #030712 !important; forced-color-adjust: none !important;"><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="600" class="email-container" style="max-width: 600px; width: 100%; background-color: #111827 !important; border-radius: 16px; overflow: hidden; border: 1px solid #374151 !important; forced-color-adjust: none !important; -webkit-text-fill-color: #F3F4F6 !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt;"><tr style="background-color: #111827 !important;"><td class="email-header" style="padding: 48px 40px 32px; text-align: center; background-color: #111827 !important; background: linear-gradient(135deg, #111827 0%, #1F2937 100%) !important; forced-color-adjust: none !important; -webkit-text-fill-color: #FFFFFF !important; color: #FFFFFF !important;"><img src="https://ygdpgliavpxeugaajgrb.supabase.co/storage/v1/object/public/Logos/ac4efca2-1fe1-49b3-9d5e-6ac3d8bf3459/Icon.png" alt="Sixty Seconds" width="80" height="80" class="email-logo" style="display: block; margin: 0 auto 24px; border: 0; max-width: 80px; width: 80px; height: auto; forced-color-adjust: none !important; background-color: transparent !important;" /><h1 class="email-title" style="color: #FFFFFF !important; -webkit-text-fill-color: #FFFFFF !important; font-size: 28px; font-weight: 700; margin: 0 0 12px 0; line-height: 1.2; letter-spacing: -0.02em; background-color: transparent !important; forced-color-adjust: none !important; text-shadow: none !important;">Welcome to {{org_name}} ✅</h1><p class="email-subtitle" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 18px; margin: 0; line-height: 1.5; font-weight: 400; background-color: transparent !important; forced-color-adjust: none !important;">Your request has been approved</p></td></tr><tr style="background-color: #111827 !important; forced-color-adjust: none !important;"><td class="email-content" style="padding: 40px 40px; background-color: #111827 !important; forced-color-adjust: none !important; -webkit-text-fill-color: #F3F4F6 !important; color: #F3F4F6 !important;"><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin-bottom: 32px; background-color: #111827 !important; forced-color-adjust: none !important;"><tr style="background-color: #111827 !important; forced-color-adjust: none !important;"><td style="background-color: #111827 !important; forced-color-adjust: none !important;"><p class="email-welcome-text" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 16px; line-height: 1.7; margin: 0 0 20px 0; text-align: center; background-color: #111827 !important; forced-color-adjust: none !important;">Hi {{first_name}},</p><p class="email-welcome-text" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 16px; line-height: 1.7; margin: 0; text-align: center; background-color: #111827 !important; forced-color-adjust: none !important;">Great news! Your request to join <strong>{{org_name}}</strong> has been approved by the organization admin. Click the button below to complete your setup.</p></td></tr></table><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin-bottom: 32px; background-color: #111827 !important; forced-color-adjust: none !important;"><tr style="background-color: #111827 !important; forced-color-adjust: none !important;"><td align="center" style="padding-bottom: 24px; background-color: #111827 !important; forced-color-adjust: none !important;"><a href="{{approval_link}}" class="email-button" style="display: inline-block; padding: 14px 32px; background-color: #10B981 !important; background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important; color: #FFFFFF !important; -webkit-text-fill-color: #FFFFFF !important; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); line-height: 1.4; forced-color-adjust: none !important;">Access Your Dashboard</a></td></tr></table></td></tr><tr style="background-color:111827 !important;"><td class="email-footer" style="padding: 24px 40px; text-align: center; background-color: #111827 !important; border-top: 1px solid #374151 !important; forced-color-adjust: none !important; -webkit-text-fill-color: #D1D5DB !important;"><p class="email-footer-text" style="color: #D1D5DB !important; -webkit-text-fill-color: #D1D5DB !important; font-size: 14px; margin: 0 0 8px 0; font-weight: 500; line-height: 1.4; background-color: transparent !important; forced-color-adjust: none !important;">Sent by Sixty Seconds</p><p class="email-footer-small" style="color: #9CA3AF !important; -webkit-text-fill-color: #9CA3AF !important; font-size: 12px; margin: 0; line-height: 1.4; background-color: transparent !important; forced-color-adjust: none !important;">This link expires in 7 days. Questions? Reply to this email.</p></td></tr></table></td></tr></table></div></body></html>',
  'WELCOME TO {{org_name}} ✅

Hi {{first_name}},

Great news! Your request to join {{org_name}} has been approved by the organization admin. Click the link below to access your dashboard.

{{approval_link}}

---

This link expires in 7 days. If the link expires, please contact your organization admin for a new one.

Questions? Reply to this email and we''ll help you out.

Sent by Sixty Seconds
© 2025 Sixty Seconds - AI Sales Assistant',
  '{"first_name": "User first name", "org_name": "Organization name", "approval_link": "Magic link to accept the join request"}',
  true,
  NOW(),
  NOW()
) ON CONFLICT DO NOTHING;

-- Template 2: join_request_rejected - sent to user when admin rejects their request
INSERT INTO encharge_email_templates (
  template_name,
  template_type,
  subject_line,
  html_body,
  text_body,
  variables,
  is_active,
  created_at,
  updated_at
) VALUES (
  'Join Request Rejected',
  'join_request_rejected',
  'Your Request to Join {{org_name}} - Update',
  '<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="color-scheme" content="light"><meta name="supported-color-schemes" content="light"><title>Request Update - Sixty Seconds</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><style type="text/css">body, table, td, p, a, li, blockquote { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }table, td { mso-table-lspace: 0pt; mso-table-rspace: 0pt; }img { -ms-interpolation-mode: bicubic; border: 0; outline: none; text-decoration: none; }html {color-scheme: light !important;background-color: #030712 !important;margin: 0 !important;padding: 0 !important;height: 100% !important;}body {color-scheme: light !important;background-color: #030712 !important;margin: 0 !important;padding: 0 !important;height: 100% !important;width: 100% !important;-webkit-text-fill-color: #F3F4F6 !important;}* {color-scheme: light !important;forced-color-adjust: none !important;}</style></head><body style="margin: 0 !important; padding: 0 !important; font-family: ''Inter'', -apple-system, BlinkMacSystemFont, ''Segoe UI'', Roboto, sans-serif; background-color: #030712 !important; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; color-scheme: light !important; forced-color-adjust: none !important; -webkit-text-fill-color: #FFFFFF !important; color: #FFFFFF !important; width: 100% !important;"><div style="background-color: #111827 !important; min-height: 100vh; width: 100% !important; margin: 0 !important; padding: 0 !important;"><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #030712 !important; padding: 0; margin: 0 auto; width: 100% !important; forced-color-adjust: none !important;"><tr style="background-color: #030712 !important;"><td align="center" style="padding: 20px 0; background-color: #030712 !important; forced-color-adjust: none !important;"><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="600" class="email-container" style="max-width: 600px; width: 100%; background-color: #111827 !important; border-radius: 16px; overflow: hidden; border: 1px solid #374151 !important; forced-color-adjust: none !important; -webkit-text-fill-color: #F3F4F6 !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt;"><tr style="background-color: #111827 !important;"><td class="email-header" style="padding: 48px 40px 32px; text-align: center; background-color: #111827 !important; background: linear-gradient(135deg, #111827 0%, #1F2937 100%) !important; forced-color-adjust: none !important; -webkit-text-fill-color: #FFFFFF !important; color: #FFFFFF !important;"><img src="https://ygdpgliavpxeugaajgrb.supabase.co/storage/v1/object/public/Logos/ac4efca2-1fe1-49b3-9d5e-6ac3d8bf3459/Icon.png" alt="Sixty Seconds" width="80" height="80" class="email-logo" style="display: block; margin: 0 auto 24px; border: 0; max-width: 80px; width: 80px; height: auto; forced-color-adjust: none !important; background-color: transparent !important;" /><h1 class="email-title" style="color: #FFFFFF !important; -webkit-text-fill-color: #FFFFFF !important; font-size: 28px; font-weight: 700; margin: 0 0 12px 0; line-height: 1.2; letter-spacing: -0.02em; background-color: transparent !important; forced-color-adjust: none !important; text-shadow: none !important;">Request Update</h1><p class="email-subtitle" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 18px; margin: 0; line-height: 1.5; font-weight: 400; background-color: transparent !important; forced-color-adjust: none !important;">Your request to join {{org_name}}</p></td></tr><tr style="background-color: #111827 !important; forced-color-adjust: none !important;"><td class="email-content" style="padding: 40px 40px; background-color: #111827 !important; forced-color-adjust: none !important; -webkit-text-fill-color: #F3F4F6 !important; color: #F3F4F6 !important;"><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin-bottom: 32px; background-color: #111827 !important; forced-color-adjust: none !important;"><tr style="background-color: #111827 !important; forced-color-adjust: none !important;"><td style="background-color: #111827 !important; forced-color-adjust: none !important;"><p class="email-welcome-text" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 16px; line-height: 1.7; margin: 0 0 20px 0; text-align: center; background-color: #111827 !important; forced-color-adjust: none !important;">Hi {{first_name}},</p><p class="email-welcome-text" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 16px; line-height: 1.7; margin: 0; text-align: center; background-color: #111827 !important; forced-color-adjust: none !important;">Thank you for your interest in joining <strong>{{org_name}}</strong>. Unfortunately, your request was not approved at this time.</p></td></tr></table><table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin-bottom: 32px; background-color: #111827 !important; forced-color-adjust: none !important;"><tr style="background-color: #111827 !important; forced-color-adjust: none !important;"><td style="background-color: #1F2937 !important; border-left: 4px solid #EF4444 !important; padding: 16px 20px; border-radius: 4px; forced-color-adjust: none !important;"><p class="email-list-text" style="color: #F3F4F6 !important; -webkit-text-fill-color: #F3F4F6 !important; font-size: 14px; margin: 0; background-color: #1F2937 !important; forced-color-adjust: none !important; line-height: 1.6;">{{rejection_reason}}</p></td></tr></table></td></tr><tr style="background-color:111827 !important;"><td class="email-footer" style="padding: 24px 40px; text-align: center; background-color: #111827 !important; border-top: 1px solid #374151 !important; forced-color-adjust: none !important; -webkit-text-fill-color: #D1D5DB !important;"><p class="email-footer-text" style="color: #D1D5DB !important; -webkit-text-fill-color: #D1D5DB !important; font-size: 14px; margin: 0 0 8px 0; font-weight: 500; line-height: 1.4; background-color: transparent !important; forced-color-adjust: none !important;">Sent by Sixty Seconds</p><p class="email-footer-small" style="color: #9CA3AF !important; -webkit-text-fill-color: #9CA3AF !important; font-size: 12px; margin: 0; line-height: 1.4; background-color: transparent !important; forced-color-adjust: none !important;">If you have questions, please contact support.</p></td></tr></table></td></tr></table></div></body></html>',
  'REQUEST UPDATE

Hi {{first_name}},

Thank you for your interest in joining {{org_name}}. Unfortunately, your request was not approved at this time.

Reason:
{{rejection_reason}}

---

If you have questions, please contact the organization admin or reply to this email.

Sent by Sixty Seconds
© 2025 Sixty Seconds - AI Sales Assistant',
  '{"first_name": "User first name", "org_name": "Organization name", "rejection_reason": "Reason for rejection"}',
  true,
  NOW(),
  NOW()
) ON CONFLICT DO NOTHING;

-- Note: join_request_admin_notification would be sent to org admins
-- This can be added later if needed for admin notifications
